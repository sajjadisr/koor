<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Google Reviews Integration Demo - Koor</title>
    <link rel="stylesheet" href="main.css">
    <style>
        .demo-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            font-family: 'Vazir', 'Tahoma', sans-serif;
        }
        
        .demo-header {
            text-align: center;
            margin-bottom: 40px;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 12px;
        }
        
        .demo-section {
            margin-bottom: 40px;
            padding: 20px;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            background: white;
        }
        
        .demo-section h3 {
            color: #333;
            border-bottom: 2px solid #667eea;
            padding-bottom: 10px;
            margin-bottom: 20px;
        }
        
        .search-form {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        
        .search-input {
            flex: 1;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 6px;
            font-size: 16px;
            min-width: 200px;
        }
        
        .search-button {
            padding: 12px 24px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            transition: background 0.3s;
        }
        
        .search-button:hover {
            background: #5a6fd8;
        }
        
        .results-container {
            min-height: 200px;
            border: 1px solid #ddd;
            border-radius: 6px;
            padding: 20px;
            background: #f9f9f9;
        }
        
        .loading {
            text-align: center;
            color: #666;
            font-style: italic;
        }
        
        .error {
            color: #d32f2f;
            background: #ffebee;
            padding: 10px;
            border-radius: 4px;
            border: 1px solid #ffcdd2;
        }
        
        .no-results {
            text-align: center;
            color: #666;
            font-style: italic;
        }
        
        .google-place {
            background: white;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .place-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            flex-wrap: wrap;
            gap: 10px;
        }
        
        .place-name {
            margin: 0;
            color: #333;
            font-size: 1.4em;
        }
        
        .place-rating {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .star {
            font-size: 18px;
        }
        
        .rating-value {
            font-weight: bold;
            color: #f57c00;
        }
        
        .total-reviews {
            color: #666;
            font-size: 0.9em;
        }
        
        .place-details {
            margin-bottom: 20px;
        }
        
        .place-address {
            color: #666;
            margin: 5px 0;
        }
        
        .place-types {
            color: #888;
            font-size: 0.9em;
            margin: 5px 0;
        }
        
        .place-reviews h4 {
            color: #333;
            margin-bottom: 15px;
        }
        
        .mini-review {
            background: #f5f5f5;
            padding: 15px;
            border-radius: 6px;
            margin-bottom: 10px;
        }
        
        .mini-review-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }
        
        .mini-reviewer {
            font-weight: bold;
            color: #333;
        }
        
        .mini-rating {
            display: flex;
            align-items: center;
            gap: 4px;
        }
        
        .mini-review-text {
            color: #555;
            line-height: 1.4;
            margin: 0;
        }
        
        .view-all-reviews {
            background: #4caf50;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            transition: background 0.3s;
            margin-top: 15px;
        }
        
        .view-all-reviews:hover {
            background: #45a049;
        }
        
        .google-review {
            background: white;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 15px;
        }
        
        .review-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 15px;
            flex-wrap: wrap;
            gap: 10px;
        }
        
        .reviewer-info {
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .reviewer-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            object-fit: cover;
        }
        
        .reviewer-name {
            margin: 0;
            color: #333;
        }
        
        .review-rating {
            display: flex;
            align-items: center;
            gap: 6px;
        }
        
        .review-time {
            text-align: left;
            color: #666;
            font-size: 0.9em;
        }
        
        .relative-time {
            display: block;
            font-weight: bold;
        }
        
        .absolute-time {
            display: block;
            font-size: 0.8em;
        }
        
        .review-content {
            margin-bottom: 15px;
        }
        
        .review-text {
            color: #333;
            line-height: 1.6;
            margin: 0;
        }
        
        .review-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            color: #888;
            font-size: 0.9em;
        }
        
        .demo-controls {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        
        .control-button {
            padding: 8px 16px;
            background: #ff9800;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            transition: background 0.3s;
        }
        
        .control-button:hover {
            background: #f57c00;
        }
        
        .cache-stats {
            background: #e3f2fd;
            padding: 15px;
            border-radius: 6px;
            border: 1px solid #bbdefb;
            margin-bottom: 20px;
        }
        
        .cache-stats h4 {
            margin: 0 0 10px 0;
            color: #1976d2;
        }
        
        .cache-stats p {
            margin: 5px 0;
            color: #333;
        }
        
        .demo-features {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .feature-card {
            background: white;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            padding: 20px;
            text-align: center;
        }
        
        .feature-icon {
            font-size: 3em;
            margin-bottom: 15px;
        }
        
        .feature-title {
            color: #333;
            margin-bottom: 10px;
        }
        
        .feature-description {
            color: #666;
            line-height: 1.5;
        }
        
        @media (max-width: 768px) {
            .search-form {
                flex-direction: column;
            }
            
            .search-input {
                min-width: auto;
            }
            
            .place-header {
                flex-direction: column;
                align-items: flex-start;
            }
            
            .review-header {
                flex-direction: column;
                align-items: flex-start;
            }
        }
    </style>
</head>
<body>
    <div class="demo-container">
        <div class="demo-header">
            <h1>Google Reviews Integration Demo</h1>
                            <p>نمایش قابلیت‌های ادغام نظرات گوگل در پلتفرم کوره</p>
        </div>

        <div class="demo-features">
            <div class="feature-card">
                <div class="feature-icon">🔍</div>
                <h3 class="feature-title">جستجوی مکان‌ها</h3>
                <p class="feature-description">جستجو در مکان‌های گوگل با استفاده از Google Places API</p>
            </div>
            <div class="feature-card">
                <div class="feature-icon">⭐</div>
                <h3 class="feature-title">نظرات گوگل</h3>
                <p class="feature-description">نمایش نظرات و امتیازات از Google Reviews</p>
            </div>
            <div class="feature-card">
                <div class="feature-icon">📍</div>
                <h3 class="feature-title">مکان‌های نزدیک</h3>
                <p class="feature-description">یافتن مکان‌های نزدیک بر اساس موقعیت جغرافیایی</p>
            </div>
            <div class="feature-card">
                <div class="feature-icon">🔄</div>
                <h3 class="feature-title">همگام‌سازی</h3>
                <p class="feature-description">همگام‌سازی خودکار نظرات با پایگاه داده محلی</p>
            </div>
        </div>

        <div class="demo-section">
            <h3>جستجوی مکان‌ها</h3>
            <div class="search-form">
                <input type="text" id="searchQuery" class="search-input" placeholder="نام مکان، رستوران، باشگاه و..." value="رستوران تهران">
                <input type="text" id="searchLocation" class="search-input" placeholder="موقعیت (اختیاری)" value="تهران">
                <button onclick="searchPlaces()" class="search-button">جستجو</button>
            </div>
            
            <div class="demo-controls">
                <button onclick="clearCache()" class="control-button">پاک کردن کش</button>
                <button onclick="showCacheStats()" class="control-button">آمار کش</button>
                <button onclick="testNearbySearch()" class="control-button">جستجوی نزدیک</button>
            </div>
            
            <div id="cacheStats" class="cache-stats" style="display: none;"></div>
            
            <div id="searchResults" class="results-container">
                <div class="loading">برای شروع جستجو، روی دکمه جستجو کلیک کنید</div>
            </div>
        </div>

        <div class="demo-section">
            <h3>اطلاعات API</h3>
            <div id="apiInfo">
                <p><strong>پایگاه API:</strong> <code>/api/places</code></p>
                <p><strong>نقطه‌های پایانی:</strong></p>
                <ul>
                    <li><code>GET /api/places/search</code> - جستجوی مکان‌ها</li>
                    <li><code>GET /api/places/:placeId</code> - جزئیات مکان</li>
                    <li><code>GET /api/places/:placeId/reviews</code> - نظرات مکان</li>
                    <li><code>GET /api/places/nearby</code> - مکان‌های نزدیک</li>
                    <li><code>POST /api/places/:placeId/reviews/sync</code> - همگام‌سازی نظرات</li>
                </ul>
            </div>
        </div>

        <div class="demo-section">
            <h3>نکات مهم</h3>
            <div style="background: #fff3cd; padding: 15px; border-radius: 6px; border: 1px solid #ffeaa7;">
                <p><strong>توجه:</strong> برای استفاده از این قابلیت‌ها، شما نیاز به:</p>
                <ul>
                    <li>کلید API گوگل (Google API Key) دارید</li>
                    <li>فعال‌سازی Google Places API در Google Cloud Console</li>
                    <li>تنظیم متغیر محیطی <code>GOOGLE_API_KEY</code></li>
                    <li>نصب وابستگی‌های جدید: <code>npm install</code></code></li>
                </ul>
            </div>
        </div>
    </div>

    <!-- Include the Google Reviews utility -->
    <script src="google-reviews.js"></script>
    
    <script>
        // Demo functions
        async function searchPlaces() {
            const query = document.getElementById('searchQuery').value;
            const location = document.getElementById('searchLocation').value;
            const resultsContainer = document.getElementById('searchResults');
            
            if (!query.trim()) {
                alert('لطفاً عبارت جستجو را وارد کنید');
                return;
            }
            
            try {
                await googleReviewsManager.searchAndDisplayPlaces(query, resultsContainer);
            } catch (error) {
                resultsContainer.innerHTML = `<div class="error">خطا در جستجو: ${error.message}</div>`;
            }
        }

        async function testNearbySearch() {
            const resultsContainer = document.getElementById('searchResults');
            resultsContainer.innerHTML = '<div class="loading">در حال جستجوی مکان‌های نزدیک...</div>';
            
            try {
                // Tehran coordinates
                const tehranLat = 35.6892;
                const tehranLng = 51.3890;
                
                const nearbyResults = await googleReviewsManager.getNearbyPlaces(
                    tehranLat, 
                    tehranLng, 
                    5000, 
                    'restaurant'
                );
                
                if (nearbyResults.places && nearbyResults.places.length > 0) {
                    googleReviewsManager.renderPlacesWithReviews(nearbyResults.places, resultsContainer);
                } else {
                    resultsContainer.innerHTML = '<div class="no-results">مکانی در نزدیکی یافت نشد</div>';
                }
            } catch (error) {
                resultsContainer.innerHTML = `<div class="error">خطا در جستجوی نزدیک: ${error.message}</div>`;
            }
        }

        function clearCache() {
            googleReviewsManager.clearCache();
            alert('کش پاک شد!');
        }

        function showCacheStats() {
            const stats = googleReviewsManager.getCacheStats();
            const statsContainer = document.getElementById('cacheStats');
            
            statsContainer.innerHTML = `
                <h4>📊 آمار کش</h4>
                <p><strong>کل ورودی‌ها:</strong> ${stats.total}</p>
                <p><strong>ورودی‌های معتبر:</strong> ${stats.valid}</p>
                <p><strong>ورودی‌های منقضی:</strong> ${stats.expired}</p>
                <p><strong>اندازه کش:</strong> ${stats.size}</p>
            `;
            
            statsContainer.style.display = 'block';
        }

        // Auto-search on page load
        document.addEventListener('DOMContentLoaded', function() {
            // Show initial instructions
            console.log('Google Reviews Demo loaded successfully!');
            console.log('Use googleReviewsManager to interact with the API');
        });

        // Handle Enter key in search inputs
        document.getElementById('searchQuery').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                searchPlaces();
            }
        });

        document.getElementById('searchLocation').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                searchPlaces();
            }
        });
    </script>
</body>
</html>
